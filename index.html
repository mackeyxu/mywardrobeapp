<html lang="zh-CN"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>我的智能衣橱</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#6366f1', // 主色调：靛蓝色
            secondary: '#f59e0b', // 辅助色：琥珀色
            neutral: {
              100: '#f3f4f6',
              200: '#e5e7eb',
              300: '#d1d5db',
              800: '#1f2937',
              900: '#111827'
            }
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-up': 'slideUp 0.3s ease-out',
            'shake': 'shake 0.5s ease-in-out'
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            shake: {
              '0%, 100%': { transform: 'translateX(0)' },
              '20%, 60%': { transform: 'translateX(-5px)' },
              '40%, 80%': { transform: 'translateX(5px)' }
            }
          }
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      .transition-custom {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
    }
  </style>
</head>

<body class="font-inter bg-gray-50 text-neutral-800 min-h-screen flex flex-col">
  <!-- 导航栏 -->
  <nav id="navbar" class="bg-white shadow-md fixed w-full z-50 transition-custom">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-tshirt text-primary text-2xl"></i>
        <h1 class="text-xl font-bold text-primary">我的智能衣橱</h1>
      </div>
      
      <div id="nav-actions" class="hidden md:flex items-center space-x-6">
        <button id="stats-btn" class="flex items-center space-x-1 text-neutral-800 hover:text-primary transition-custom">
          <i class="fa fa-chart-pie"></i>
          <span>统计分析</span>
        </button>
        <button id="logout-btn" class="hidden flex items-center space-x-1 text-neutral-800 hover:text-red-500 transition-custom">
          <i class="fa fa-sign-out"></i>
          <span>退出登录</span>
        </button>
      </div>
      
      <button id="mobile-menu-btn" class="md:hidden text-neutral-800 hover:text-primary">
        <i class="fa fa-bars text-xl"></i>
      </button>
    </div>
    
    <!-- 移动端菜单 -->
    <div id="mobile-menu" class="hidden md:hidden bg-white border-t animate-fade-in">
      <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
        <button id="mobile-stats-btn" class="py-2 flex items-center space-x-2 text-neutral-800 hover:text-primary transition-custom">
          <i class="fa fa-chart-pie w-5 text-center"></i>
          <span>统计分析</span>
        </button>
        <button id="mobile-logout-btn" class="hidden py-2 flex items-center space-x-2 text-neutral-800 hover:text-red-500 transition-custom">
          <i class="fa fa-sign-out w-5 text-center"></i>
          <span>退出登录</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- 登录页面 -->
  <div id="login-page" class="flex-grow flex items-center justify-center p-4 animate-fade-in">
    <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-6 md:p-8 card-shadow">
      <div class="text-center mb-6">
        <i class="fa fa-tshirt text-primary text-4xl mb-3"></i>
        <h2 class="text-2xl font-bold text-neutral-800">智能衣橱管理</h2>
        <p class="text-neutral-500 mt-1">请登录以访问您的衣橱</p>
      </div>
      
      <form id="login-form" class="space-y-4">
        <div>
          <label for="username" class="block text-sm font-medium text-neutral-700 mb-1">用户名</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fa fa-user text-neutral-400"></i>
            </div>
            <input type="text" id="username" name="username" required="" class="block w-full pl-10 pr-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom" placeholder="请输入用户名">
          </div>
        </div>
        
        <div>
          <label for="password" class="block text-sm font-medium text-neutral-700 mb-1">密码</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fa fa-lock text-neutral-400"></i>
            </div>
            <input type="password" id="password" name="password" required="" class="block w-full pl-10 pr-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom" placeholder="请输入密码">
            <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-neutral-400 hover:text-neutral-800">
              <i class="fa fa-eye-slash"></i>
            </button>
          </div>
        </div>
        
        <div class="pt-2">
          <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom flex items-center justify-center space-x-2">
            <span>登录</span>
            <i class="fa fa-arrow-right"></i>
          </button>
        </div>
      </form>
      
      <div id="login-error" class="mt-4 text-center text-red-500 text-sm hidden">
        用户名或密码错误，请重试
      </div>
      
      <div class="mt-6 text-center text-sm text-neutral-500">
        <p>默认账号: <span class="font-medium">admin</span></p>
        <p>默认密码: <span class="font-medium">password</span></p>
      </div>
    </div>
  </div>

  <!-- 主应用内容 -->
  <div id="app-content" class="hidden flex-grow pt-16 pb-8 px-4 md:px-6">
    <div class="container mx-auto">
      <!-- 添加衣物按钮 -->
      <div class="mb-6 text-right">
        <div class="inline-flex space-x-2">
          <button id="add-item-btn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom flex items-center space-x-2">
            <i class="fa fa-plus"></i>
            <span>添加衣物</span>
          </button>
          <button id="batch-upload-btn" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom flex items-center space-x-2">
            <i class="fa fa-upload"></i>
            <span>批量上传</span>
          </button>
        </div>
      </div>
      
      <!-- 分类筛选 -->
      <div class="mb-6 overflow-x-auto pb-2">
        <div class="flex space-x-2 min-w-max">
          <button class="category-btn active px-4 py-2 rounded-full bg-primary text-white text-sm font-medium transition-custom" data-category="all">
            全部
          </button>
          <button class="category-btn px-4 py-2 rounded-full bg-neutral-200 hover:bg-neutral-300 text-neutral-800 text-sm font-medium transition-custom" data-category="上衣">
            <i class="fa fa-tshirt mr-1"></i>上衣
          </button>
          <button class="category-btn px-4 py-2 rounded-full bg-neutral-200 hover:bg-neutral-300 text-neutral-800 text-sm font-medium transition-custom" data-category="裤子">
            <i class="fa fa-socks mr-1"></i>裤子
          </button>
          <button class="category-btn px-4 py-2 rounded-full bg-neutral-200 hover:bg-neutral-300 text-neutral-800 text-sm font-medium transition-custom" data-category="鞋子">
            <i class="fa fa-shoe-prints mr-1"></i>鞋子
          </button>
          <button class="category-btn px-4 py-2 rounded-full bg-neutral-200 hover:bg-neutral-300 text-neutral-800 text-sm font-medium transition-custom" data-category="配饰">
            <i class="fa fa-sun mr-1"></i>配饰
          </button>
        </div>
      </div>
      
      <!-- 衣物列表 -->
      <div id="wardrobe-items" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
        <!-- 衣物项将通过JavaScript动态生成 -->
      </div>
      
      <!-- 空状态提示 -->
      <div id="empty-state" class="text-center py-12 hidden">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-neutral-100 mb-4">
          <i class="fa fa-box text-2xl text-neutral-400"></i>
        </div>
        <h3 class="text-lg font-medium text-neutral-800 mb-2">衣橱还是空的</h3>
        <p class="text-neutral-500 mb-4">添加你的第一件衣物吧</p>
        <div class="inline-flex space-x-2">
          <button id="empty-add-btn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
            <i class="fa fa-plus mr-1"></i>添加衣物
          </button>
          <button id="empty-batch-btn" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
            <i class="fa fa-upload mr-1"></i>批量上传
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 统计分析模态框 -->
  <div id="stats-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto animate-slide-up">
      <div class="p-6 border-b">
        <div class="flex justify-between items-center">
          <h3 class="text-xl font-bold text-neutral-800">衣物统计分析</h3>
          <button id="close-stats-btn" class="text-neutral-500 hover:text-neutral-800 transition-custom">
            <i class="fa fa-times text-xl"></i>
          </button>
        </div>
      </div>
      
      <div class="p-6 space-y-8">
        <!-- 分类统计图表 -->
        <div>
          <h4 class="text-lg font-medium text-neutral-800 mb-4">衣物分类占比</h4>
          <div class="h-64 md:h-80">
            <canvas id="category-chart"></canvas>
          </div>
        </div>
        
        <!-- 季节统计图表 -->
        <div>
          <h4 class="text-lg font-medium text-neutral-800 mb-4">季节分布</h4>
          <div class="h-64 md:h-80">
            <canvas id="season-chart"></canvas>
          </div>
        </div>
        
        <!-- 穿着频率统计 -->
        <div>
          <h4 class="text-lg font-medium text-neutral-800 mb-4">穿着频率最高的衣物</h4>
          <div id="frequency-list" class="space-y-3">
            <!-- 频率列表将通过JavaScript动态生成 -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 添加/编辑衣物模态框 -->
  <div id="item-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md animate-slide-up">
      <div class="p-6 border-b flex justify-between items-center">
        <h3 id="modal-title" class="text-xl font-bold text-neutral-800">添加新衣物</h3>
        <button id="close-modal-btn" class="text-neutral-500 hover:text-neutral-800 transition-custom">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <form id="item-form" class="p-6 space-y-4">
        <input type="hidden" id="item-id">
        
        <div>
          <label for="name" class="block text-sm font-medium text-neutral-700 mb-1">衣物名称</label>
          <input type="text" id="name" name="name" required="" class="block w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom" placeholder="例如：黑色T恤">
        </div>
        
        <div>
          <label for="category" class="block text-sm font-medium text-neutral-700 mb-1">分类</label>
          <select id="category" name="category" required="" class="block w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom">
            <option value="">请选择分类</option>
            <option value="上衣">上衣</option>
            <option value="裤子">裤子</option>
            <option value="鞋子">鞋子</option>
            <option value="配饰">配饰</option>
          </select>
        </div>
        
        <div>
          <label for="season" class="block text-sm font-medium text-neutral-700 mb-1">适用季节</label>
          <select id="season" name="season" required="" class="block w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom">
            <option value="">请选择季节</option>
            <option value="春季">春季</option>
            <option value="夏季">夏季</option>
            <option value="秋季">秋季</option>
            <option value="冬季">冬季</option>
            <option value="四季">四季皆宜</option>
          </select>
        </div>
        
        <div>
          <label for="color" class="block text-sm font-medium text-neutral-700 mb-1">颜色</label>
          <input type="text" id="color" name="color" required="" class="block w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom" placeholder="例如：黑色、蓝色条纹">
        </div>
        
        <div>
          <label for="brand" class="block text-sm font-medium text-neutral-700 mb-1">品牌（可选）</label>
          <input type="text" id="brand" name="brand" class="block w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom" placeholder="例如：优衣库">
        </div>
        
        <div class="pt-2">
          <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
            保存
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 批量上传模态框 -->
  <div id="batch-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-slide-up">
      <div class="p-6 border-b flex justify-between items-center">
        <h3 class="text-xl font-bold text-neutral-800">批量添加衣物</h3>
        <button id="close-batch-btn" class="text-neutral-500 hover:text-neutral-800 transition-custom">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="p-6">
        <p class="text-neutral-600 mb-4">每行输入一件衣物信息，格式：名称,分类,季节,颜色,品牌（品牌可选）</p>
        <p class="text-sm text-neutral-500 mb-6">示例：<br>
          黑色T恤,上衣,夏季,黑色,优衣库<br>
          牛仔裤,裤子,四季,蓝色,李维斯
        </p>
        
        <textarea id="batch-content" rows="10" class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom font-mono text-sm" placeholder="按格式输入多个衣物信息，每行一个..."></textarea>
        
        <div class="mt-6 flex space-x-3">
          <button id="batch-confirm-btn" class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
            <i class="fa fa-check mr-1"></i> 批量添加
          </button>
          <button id="batch-clear-btn" class="px-4 bg-neutral-200 hover:bg-neutral-300 text-neutral-800 font-medium py-2 rounded-lg transition-custom">
            清空
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 穿着记录模态框 -->
  <div id="wear-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md animate-slide-up">
      <div class="p-6 border-b flex justify-between items-center">
        <h3 class="text-xl font-bold text-neutral-800">记录穿着</h3>
        <button id="close-wear-btn" class="text-neutral-500 hover:text-neutral-800 transition-custom">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="p-6">
        <p id="wear-item-name" class="text-lg font-medium mb-4">黑色T恤</p>
        
        <p class="text-neutral-600 mb-6">今天穿了这件衣物吗？记录后将更新穿着频率。</p>
        
        <div class="flex space-x-4">
          <button id="confirm-wear-btn" class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-custom">
            是的，穿了
          </button>
          <button id="cancel-wear-btn" class="flex-1 bg-neutral-200 hover:bg-neutral-300 text-neutral-800 font-medium py-2 px-4 rounded-lg transition-custom">
            取消
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 确认删除模态框 -->
  <div id="delete-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md animate-slide-up">
      <div class="p-6 border-b">
        <h3 class="text-xl font-bold text-neutral-800">确认删除</h3>
      </div>
      
      <div class="p-6">
        <p class="text-neutral-600 mb-6">你确定要删除这件衣物吗？此操作无法撤销。</p>
        
        <div class="flex space-x-4">
          <button id="confirm-delete-btn" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition-custom">
            删除
          </button>
          <button id="cancel-delete-btn" class="flex-1 bg-neutral-200 hover:bg-neutral-300 text-neutral-800 font-medium py-2 px-4 rounded-lg transition-custom">
            取消
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 通知提示 -->
  <div id="notification" class="fixed bottom-4 right-4 bg-neutral-800 text-white px-4 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center space-x-2 z-50">
    <i id="notification-icon" class="fa fa-check-circle text-green-400"></i>
    <span id="notification-text">操作成功</span>
  </div>

  <script>
    // 登录状态管理
    const Auth = {
      // 检查用户是否已登录
      isLoggedIn() {
        return localStorage.getItem('wardrobe_logged_in') === 'true';
      },
      
      // 登录函数
      login(username, password) {
        // 在实际应用中，这里应该发送请求到后端验证
        // 这里使用预设的用户名和密码进行演示
        const validUsername = 'mackey';
        const validPassword = 'Xu920926';
        
        if (username === validUsername && password === validPassword) {
          localStorage.setItem('wardrobe_logged_in', 'true');
          localStorage.setItem('wardrobe_username', username);
          return true;
        }
        return false;
      },
      
      // 登出函数
      logout() {
        localStorage.setItem('wardrobe_logged_in', 'false');
        localStorage.removeItem('wardrobe_username');
        this.updateUI();
      },
      
      // 更新UI以反映登录状态
      updateUI() {
        const isLoggedIn = this.isLoggedIn();
        const loginPage = document.getElementById('login-page');
        const appContent = document.getElementById('app-content');
        const logoutBtn = document.getElementById('logout-btn');
        const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
        
        if (isLoggedIn) {
          loginPage.classList.add('hidden');
          appContent.classList.remove('hidden');
          logoutBtn.classList.remove('hidden');
          mobileLogoutBtn.classList.remove('hidden');
          Wardrobe.loadItems();
        } else {
          loginPage.classList.remove('hidden');
          appContent.classList.add('hidden');
          logoutBtn.classList.add('hidden');
          mobileLogoutBtn.classList.add('hidden');
        }
      }
    };

    // 衣橱数据管理
    const Wardrobe = {
      items: [],
      
      // 初始化
      init() {
        this.loadItems();
        this.setupEventListeners();
      },
      
      // 从本地存储加载衣物数据
      loadItems() {
        const savedItems = localStorage.getItem('wardrobe_items');
        this.items = savedItems? JSON.parse(savedItems) : [];
        this.renderItems();
        this.updateEmptyState();
        Stats.updateCharts();
      },
      
      // 保存衣物数据到本地存储
      saveItems() {
        localStorage.setItem('wardrobe_items', JSON.stringify(this.items));
        this.renderItems();
        this.updateEmptyState();
        Stats.updateCharts();
      },
      
      // 添加新衣物
      addItem(item) {
        const newItem = {
          id: Date.now().toString(), // 使用时间戳作为唯一ID
          name: item.name,
          category: item.category,
          season: item.season,
          color: item.color,
          brand: item.brand || '',
          wearCount: 0,
          lastWorn: null,
          addedDate: new Date().toISOString()
        };
        
        this.items.push(newItem);
        this.saveItems();
        return newItem;
      },
      
      // 批量添加衣物
      batchAddItems(itemsData) {
        const successCount = [];
        const errorItems = [];
        
        itemsData.forEach((item, index) => {
          // 验证必填项
          if (!item.name || !item.category || !item.season || !item.color) {
            errorItems.push({ line: index + 1, reason: "缺少必填项（名称、分类、季节、颜色）" });
            return;
          }
          
          // 验证分类是否有效
          const validCategories = ['上衣', '裤子', '鞋子', '配饰'];
          if (!validCategories.includes(item.category)) {
            errorItems.push({ line: index + 1, reason: "分类无效（必须是：上衣、裤子、鞋子、配饰）" });
            return;
          }
          
          // 验证季节是否有效
          const validSeasons = ['春季', '夏季', '秋季', '冬季', '四季'];
          if (!validSeasons.includes(item.season)) {
            errorItems.push({ line: index + 1, reason: "季节无效（必须是：春季、夏季、秋季、冬季、四季）" });
            return;
          }
          
          // 添加到衣橱
          this.addItem(item);
          successCount.push(1);
        });
        
        return {
          success: successCount.length,
          errors: errorItems
        };
      },
      
      // 更新衣物信息
      updateItem(id, updatedData) {
        const index = this.items.findIndex(item => item.id === id);
        if (index !== -1) {
          this.items[index] = { ...this.items[index], ...updatedData };
          this.saveItems();
          return this.items[index];
        }
        return null;
      },
      
      // 记录穿着
      recordWear(id) {
        const index = this.items.findIndex(item => item.id === id);
        if (index !== -1) {
          this.items[index].wearCount += 1;
          this.items[index].lastWorn = new Date().toISOString();
          this.saveItems();
          return this.items[index];
        }
        return null;
      },
      
      // 删除衣物
      deleteItem(id) {
        this.items = this.items.filter(item => item.id !== id);
        this.saveItems();
      },
      
      // 渲染衣物列表
      renderItems(filterCategory = 'all') {
        const container = document.getElementById('wardrobe-items');
        container.innerHTML = '';
        
        const filteredItems = filterCategory === 'all' 
          ? this.items 
          : this.items.filter(item => item.category === filterCategory);
        
        if (filteredItems.length === 0 && filterCategory !== 'all') {
          container.innerHTML = `
            <div class="col-span-full text-center py-12">
              <p class="text-neutral-500">没有找到该分类的衣物</p>
            </div>
          `;
          return;
        }
        
        filteredItems.forEach(item => {
          const card = document.createElement('div');
          card.className = 'bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-custom group';
          
          // 根据分类选择不同的图标
          let categoryIcon = 'fa-tshirt';
          if (item.category === '裤子') categoryIcon = 'fa-socks';
          if (item.category === '鞋子') categoryIcon = 'fa-shoe-prints';
          if (item.category === '配饰') categoryIcon = 'fa-sun';
          
          // 格式化日期
          const addedDate = new Date(item.addedDate);
          const formattedDate = `${addedDate.getFullYear()}-${(addedDate.getMonth() + 1).toString().padStart(2, '0')}-${addedDate.getDate().toString().padStart(2, '0')}`;
          
          card.innerHTML = `
            <div class="h-48 bg-neutral-100 flex items-center justify-center p-4">
              <i class="fa ${categoryIcon} text-6xl text-primary/70 group-hover:text-primary transition-custom"></i>
            </div>
            <div class="p-4">
              <div class="flex justify-between items-start mb-2">
                <h3 class="font-medium text-neutral-800">${item.name}</h3>
                <span class="px-2 py-1 bg-primary/10 text-primary text-xs rounded-full">${item.category}</span>
              </div>
              
              <div class="space-y-1 text-sm text-neutral-600 mb-3">
                <p><span class="text-neutral-500">颜色：</span>${item.color}</p>
                <p><span class="text-neutral-500">季节：</span>${item.season}</p>
                ${item.brand ? `<p><span class="text-neutral-500">品牌：</span>${item.brand}</p>` : ''}
              </div>
              
              <div class="flex justify-between items-center text-xs text-neutral-500 mb-3">
                <span>添加于 ${formattedDate}</span>
                <span>穿着 ${item.wearCount} 次</span>
              </div>
              
              <div class="flex space-x-2">
                <button class="wear-btn flex-1 py-1.5 bg-neutral-100 hover:bg-neutral-200 text-neutral-800 rounded-lg transition-custom" data-id="${item.id}">
                  <i class="fa fa-check mr-1"></i> 穿着
                </button>
                <button class="edit-btn w-10 py-1.5 bg-neutral-100 hover:bg-neutral-200 text-neutral-800 rounded-lg transition-custom" data-id="${item.id}">
                  <i class="fa fa-edit"></i>
                </button>
                <button class="delete-btn w-10 py-1.5 bg-neutral-100 hover:bg-red-100 hover:text-red-500 text-neutral-800 rounded-lg transition-custom" data-id="${item.id}">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </div>
          `;
          
          container.appendChild(card);
        });
        
        // 添加事件监听器
        this.addItemEventListeners();
      },
      
      // 添加衣物项的事件监听器
      addItemEventListeners() {
        // 穿着按钮
        document.querySelectorAll('.wear-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const id = e.currentTarget.dataset.id;
            const item = this.items.find(item => item.id === id);
            if (item) {
              document.getElementById('wear-item-name').textContent = item.name;
              document.getElementById('confirm-wear-btn').dataset.id = id;
              document.getElementById('wear-modal').classList.remove('hidden');
            }
          });
        });
        
        // 编辑按钮
        document.querySelectorAll('.edit-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const id = e.currentTarget.dataset.id;
            const item = this.items.find(item => item.id === id);
            if (item) {
              this.openEditModal(item);
            }
          });
        });
        
        // 删除按钮
        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const id = e.currentTarget.dataset.id;
            document.getElementById('confirm-delete-btn').dataset.id = id;
            document.getElementById('delete-modal').classList.remove('hidden');
          });
        });
      },
      
      // 更新空状态显示
      updateEmptyState() {
        const emptyState = document.getElementById('empty-state');
        const itemsContainer = document.getElementById('wardrobe-items');
        
        if (this.items.length === 0) {
          emptyState.classList.remove('hidden');
          itemsContainer.classList.add('hidden');
        } else {
          emptyState.classList.add('hidden');
          itemsContainer.classList.remove('hidden');
        }
      },
      
      // 打开添加衣物模态框
      openAddModal() {
        document.getElementById('modal-title').textContent = '添加新衣物';
        document.getElementById('item-form').reset();
        document.getElementById('item-id').value = '';
        document.getElementById('item-modal').classList.remove('hidden');
      },
      
      // 打开编辑衣物模态框
      openEditModal(item) {
        document.getElementById('modal-title').textContent = '编辑衣物';
        document.getElementById('item-id').value = item.id;
        document.getElementById('name').value = item.name;
        document.getElementById('category').value = item.category;
        document.getElementById('season').value = item.season;
        document.getElementById('color').value = item.color;
        document.getElementById('brand').value = item.brand || '';
        document.getElementById('item-modal').classList.remove('hidden');
      },
      
      // 设置事件监听器
      setupEventListeners() {
        // 添加衣物按钮
        document.getElementById('add-item-btn').addEventListener('click', () => this.openAddModal());
        document.getElementById('empty-add-btn').addEventListener('click', () => this.openAddModal());
        
        // 批量上传按钮
        document.getElementById('batch-upload-btn').addEventListener('click', () => {
          document.getElementById('batch-modal').classList.remove('hidden');
          document.getElementById('batch-content').value = '';
        });
        document.getElementById('empty-batch-btn').addEventListener('click', () => {
          document.getElementById('batch-modal').classList.remove('hidden');
          document.getElementById('batch-content').value = '';
        });
        
        // 关闭批量上传模态框
        document.getElementById('close-batch-btn').addEventListener('click', () => {
          document.getElementById('batch-modal').classList.add('hidden');
        });
        
        // 清空批量输入框
        document.getElementById('batch-clear-btn').addEventListener('click', () => {
          document.getElementById('batch-content').value = '';
        });
        
        // 确认批量添加
        document.getElementById('batch-confirm-btn').addEventListener('click', () => {
          const content = document.getElementById('batch-content').value.trim();
          if (!content) {
            Notification.show('请输入衣物信息', 'error');
            return;
          }
          
          // 解析输入内容
          const lines = content.split('\n').filter(line => line.trim() !== '');
          const itemsData = lines.map(line => {
            const parts = line.split(',').map(p => p.trim());
            return {
              name: parts[0] || '',
              category: parts[1] || '',
              season: parts[2] || '',
              color: parts[3] || '',
              brand: parts[4] || ''
            };
          });
          
          // 批量添加
          const result = this.batchAddItems(itemsData);
          
          // 显示结果
          if (result.errors.length === 0) {
            Notification.show(`成功添加 ${result.success} 件衣物`, 'success');
            document.getElementById('batch-modal').classList.add('hidden');
          } else {
            let errorMsg = `成功添加 ${result.success} 件，以下行有错误：\n`;
            result.errors.forEach(err => {
              errorMsg += `第 ${err.line} 行：${err.reason}\n`;
            });
            alert(errorMsg); // 显示详细错误信息
          }
        });
        
        // 关闭模态框按钮
        document.getElementById('close-modal-btn').addEventListener('click', () => {
          document.getElementById('item-modal').classList.add('hidden');
        });
        
        // 关闭穿着记录模态框
        document.getElementById('close-wear-btn').addEventListener('click', () => {
          document.getElementById('wear-modal').classList.add('hidden');
        });
        
        document.getElementById('cancel-wear-btn').addEventListener('click', () => {
          document.getElementById('wear-modal').classList.add('hidden');
        });
        
        // 确认穿着记录
        document.getElementById('confirm-wear-btn').addEventListener('click', (e) => {
          const id = e.currentTarget.dataset.id;
          this.recordWear(id);
          document.getElementById('wear-modal').classList.add('hidden');
          Notification.show('已记录穿着', 'success');
        });
        
        // 关闭删除模态框
        document.getElementById('cancel-delete-btn').addEventListener('click', () => {
          document.getElementById('delete-modal').classList.add('hidden');
        });
        
        // 确认删除
        document.getElementById('confirm-delete-btn').addEventListener('click', (e) => {
          const id = e.currentTarget.dataset.id;
          this.deleteItem(id);
          document.getElementById('delete-modal').classList.add('hidden');
          Notification.show('已删除衣物', 'success');
        });
        
        // 提交衣物表单
        document.getElementById('item-form').addEventListener('submit', (e) => {
          e.preventDefault();
          
          const id = document.getElementById('item-id').value;
          const itemData = {
            name: document.getElementById('name').value,
            category: document.getElementById('category').value,
            season: document.getElementById('season').value,
            color: document.getElementById('color').value,
            brand: document.getElementById('brand').value
          };
          
          if (id) {
            this.updateItem(id, itemData);
            Notification.show('衣物已更新', 'success');
          } else {
            this.addItem(itemData);
            Notification.show('新衣物已添加', 'success');
          }
          
          document.getElementById('item-modal').classList.add('hidden');
        });
        
        // 分类筛选按钮
        document.querySelectorAll('.category-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            // 更新按钮样式
            document.querySelectorAll('.category-btn').forEach(b => {
              b.classList.remove('active', 'bg-primary', 'text-white');
              b.classList.add('bg-neutral-200', 'hover:bg-neutral-300', 'text-neutral-800');
            });
            
            e.currentTarget.classList.add('active', 'bg-primary', 'text-white');
            e.currentTarget.classList.remove('bg-neutral-200', 'hover:bg-neutral-300', 'text-neutral-800');
            
            // 筛选衣物
            const category = e.currentTarget.dataset.category;
            this.renderItems(category);
          });
        });
      }
    };

    // 统计分析功能
    const Stats = {
      categoryChart: null,
      seasonChart: null,
      
      // 初始化图表
      init() {
        this.setupEventListeners();
      },
      
      // 更新图表数据
      updateCharts() {
        const items = Wardrobe.items;
        this.updateCategoryChart(items);
        this.updateSeasonChart(items);
        this.updateFrequencyList(items);
      },
      
      // 更新分类图表
      updateCategoryChart(items) {
        const ctx = document.getElementById('category-chart').getContext('2d');
        
        // 统计各分类数量
        const categories = ['上衣', '裤子', '鞋子', '配饰'];
        const counts = categories.map(cat => {
          return items.filter(item => item.category === cat).length;
        });
        
        // 颜色配置
        const colors = ['#6366f1', '#f59e0b', '#10b981', '#ef4444'];
        
        // 如果图表已存在，销毁它
        if (this.categoryChart) {
          this.categoryChart.destroy();
        }
        
        // 创建新图表
        this.categoryChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: categories,
            datasets: [{
              data: counts,
              backgroundColor: colors,
              borderWidth: 0,
              hoverOffset: 4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  padding: 20,
                  font: {
                    size: 12
                  }
                }
              }
            },
            cutout: '65%'
          }
        });
      },
      
      // 更新季节图表
      updateSeasonChart(items) {
        const ctx = document.getElementById('season-chart').getContext('2d');
        
        // 统计各季节数量
        const seasons = ['春季', '夏季', '秋季', '冬季', '四季'];
        const counts = seasons.map(season => {
          return items.filter(item => item.season === season).length;
        });
        
        // 颜色配置
        const colors = ['#10b981', '#f59e0b', '#f97316', '#3b82f6', '#64748b'];
        
        // 如果图表已存在，销毁它
        if (this.seasonChart) {
          this.seasonChart.destroy();
        }
        
        // 创建新图表
        this.seasonChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: seasons,
            datasets: [{
              label: '衣物数量',
              data: counts,
              backgroundColor: colors,
              borderRadius: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                }
              }
            }
          }
        });
      },
      
      // 更新穿着频率列表
      updateFrequencyList(items) {
        const container = document.getElementById('frequency-list');
        container.innerHTML = '';
        
        // 按穿着次数排序（从高到低）
        const sortedItems = [...items].sort((a, b) => b.wearCount - a.wearCount).slice(0, 5);
        
        if (sortedItems.length === 0) {
          container.innerHTML = '<p class="text-neutral-500 text-center py-4">还没有穿着记录</p>';
          return;
        }
        
        sortedItems.forEach((item, index) => {
          const itemElement = document.createElement('div');
          itemElement.className = 'flex items-center justify-between p-3 bg-neutral-50 rounded-lg';
          
          // 奖牌图标（前三名）
          let medalIcon = '';
          if (index === 0) medalIcon = '<i class="fa fa-medal text-yellow-500 mr-2"></i>';
          if (index === 1) medalIcon = '<i class="fa fa-medal text-gray-400 mr-2"></i>';
          if (index === 2) medalIcon = '<i class="fa fa-medal text-amber-700 mr-2"></i>';
          
          itemElement.innerHTML = `
            <div class="flex items-center">
              <span class="text-neutral-500 w-6 text-center mr-2">${index + 1}.</span>
              ${medalIcon}
              <span class="font-medium">${item.name}</span>
            </div>
            <span class="px-2 py-1 bg-primary/10 text-primary text-sm rounded-full">
              穿着 ${item.wearCount} 次
            </span>
          `;
          
          container.appendChild(itemElement);
        });
      },
      
      // 设置事件监听器
      setupEventListeners() {
        // 打开统计模态框
        document.getElementById('stats-btn').addEventListener('click', () => {
          document.getElementById('stats-modal').classList.remove('hidden');
          this.updateCharts();
        });
        
        document.getElementById('mobile-stats-btn').addEventListener('click', () => {
          document.getElementById('mobile-menu').classList.add('hidden');
          document.getElementById('stats-modal').classList.remove('hidden');
          this.updateCharts();
        });
        
        // 关闭统计模态框
        document.getElementById('close-stats-btn').addEventListener('click', () => {
          document.getElementById('stats-modal').classList.add('hidden');
        });
      }
    };

    // 通知提示功能
    const Notification = {
      show(message, type = 'success') {
        const notification = document.getElementById('notification');
        const textElement = document.getElementById('notification-text');
        const iconElement = document.getElementById('notification-icon');
        
        // 设置消息和图标
        textElement.textContent = message;
        
        // 设置图标和颜色
        iconElement.className = '';
        if (type === 'success') {
          iconElement.className = 'fa fa-check-circle text-green-400';
        } else if (type === 'error') {
          iconElement.className = 'fa fa-exclamation-circle text-red-400';
        } else if (type === 'info') {
          iconElement.className = 'fa fa-info-circle text-blue-400';
        }
        
        // 显示通知
        notification.classList.remove('translate-y-20', 'opacity-0');
        notification.classList.add('translate-y-0', 'opacity-100');
        
        // 3秒后隐藏通知
        setTimeout(() => {
          notification.classList.remove('translate-y-0', 'opacity-100');
          notification.classList.add('translate-y-20', 'opacity-0');
        }, 3000);
      }
    };

    // 移动端菜单控制
    function setupMobileMenu() {
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      
      mobileMenuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });
    }

    // 密码显示/隐藏切换
    function setupPasswordToggle() {
      const toggleBtn = document.getElementById('toggle-password');
      const passwordInput = document.getElementById('password');
      
      toggleBtn.addEventListener('click', () => {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        
        // 切换图标
        const icon = toggleBtn.querySelector('i');
        if (type === 'password') {
          icon.classList.remove('fa-eye');
          icon.classList.add('fa-eye-slash');
        } else {
          icon.classList.remove('fa-eye-slash');
          icon.classList.add('fa-eye');
        }
      });
    }

    // 登录表单处理
    function setupLoginForm() {
      const loginForm = document.getElementById('login-form');
      const errorElement = document.getElementById('login-error');
      
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        if (Auth.login(username, password)) {
          errorElement.classList.add('hidden');
          Auth.updateUI();
          Notification.show('登录成功', 'success');
        } else {
          errorElement.classList.remove('hidden');
          // 添加抖动动画
          loginForm.classList.add('animate-shake');
          setTimeout(() => {
            loginForm.classList.remove('animate-shake');
          }, 500);
        }
      });
    }

    // 登出功能
    function setupLogout() {
      document.getElementById('logout-btn').addEventListener('click', () => {
        Auth.logout();
        Notification.show('已成功退出登录', 'info');
      });
      
      document.getElementById('mobile-logout-btn').addEventListener('click', () => {
        document.getElementById('mobile-menu').classList.add('hidden');
        Auth.logout();
        Notification.show('已成功退出登录', 'info');
      });
    }

    // 导航栏滚动效果
    function setupNavbarScrollEffect() {
      const navbar = document.getElementById('navbar');
      
      window.addEventListener('scroll', () => {
        if (window.scrollY > 10) {
          navbar.classList.add('py-2', 'shadow-lg');
          navbar.classList.remove('py-3', 'shadow-md');
        } else {
          navbar.classList.add('py-3', 'shadow-md');
          navbar.classList.remove('py-2', 'shadow-lg');
        }
      });
    }

    // 初始化应用
    function initApp() {
      // 检查登录状态
      Auth.updateUI();
      
      // 初始化各模块
      if (Auth.isLoggedIn()) {
        Wardrobe.init();
        Stats.init();
      }
      
      // 设置其他功能
      setupMobileMenu();
      setupPasswordToggle();
      setupLoginForm();
      setupLogout();
      setupNavbarScrollEffect();
    }

    // 页面加载完成后初始化应用
    document.addEventListener('DOMContentLoaded', initApp);
  </script>


</body></html>