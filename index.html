<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的智能衣橱</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1', // 靛蓝色作为主色调
                        secondary: '#f59e0b', // 琥珀色作为辅助色
                        neutral: {
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                },
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            .hover-lift {
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            .hover-lift:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            }
            .modal-backdrop {
                backdrop-filter: blur(4px);
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-neutral-800 min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <nav id="navbar" class="bg-white shadow-md fixed w-full top-0 z-50 transition-all duration-300 transform -translate-y-full">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-tshirt text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-primary">我的智能衣橱</h1>
            </div>
            
            <div class="hidden md:flex items-center space-x-6">
                <button id="statsBtn" class="flex items-center space-x-1 text-neutral-600 hover:text-primary transition-colors">
                    <i class="fa fa-chart-pie"></i>
                    <span>统计分析</span>
                </button>
                <button id="logoutBtn" class="flex items-center space-x-1 text-neutral-600 hover:text-primary transition-colors">
                    <i class="fa fa-sign-out"></i>
                    <span>退出登录</span>
                </button>
            </div>
            
            <button id="mobileMenuBtn" class="md:hidden text-neutral-600 hover:text-primary" title="打开菜单">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- 移动端菜单 -->
        <div id="mobileMenu" class="md:hidden hidden bg-white border-t border-gray-100 animate-fade-in">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <button id="mobileStatsBtn" class="flex items-center space-x-2 py-2 text-neutral-600 hover:text-primary transition-colors">
                    <i class="fa fa-chart-pie w-5 text-center"></i>
                    <span>统计分析</span>
                </button>
                <button id="mobileLogoutBtn" class="flex items-center space-x-2 py-2 text-neutral-600 hover:text-primary transition-colors">
                    <i class="fa fa-sign-out w-5 text-center"></i>
                    <span>退出登录</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="flex-grow pt-16">
        <!-- 登录页面 -->
        <section id="loginPage" class="min-h-screen flex items-center justify-center p-4">
            <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-8 animate-slide-up">
                <div class="text-center mb-6">
                    <i class="fa fa-tshirt text-primary text-4xl mb-3"></i>
                    <h2 class="text-2xl font-bold text-neutral-800">智能衣橱管理系统</h2>
                    <p class="text-neutral-500">请登录以继续</p>
                </div>
                
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-neutral-700 mb-1">用户名</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-neutral-400">
                                <i class="fa fa-user"></i>
                            </span>
                            <input type="text" id="username" name="username" 
                                class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none"
                                placeholder="请输入用户名" required>
                        </div>
                    </div>
                    
                    <div>
                        <label for="password" class="block text-sm font-medium text-neutral-700 mb-1">密码</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-neutral-400">
                                <i class="fa fa-lock"></i>
                            </span>
                            <input type="password" id="password" name="password" 
                                class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none"
                                placeholder="请输入密码" required>
                            <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 flex items-center pr-3 text-neutral-400 hover:text-primary transition-colors" title="显示/隐藏密码">
                                <i class="fa fa-eye-slash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2">
                        <span>登录</span>
                        <i class="fa fa-arrow-right"></i>
                    </button>
                </form>
                
                <div class="mt-4 text-center text-sm text-neutral-500">
                    <p>默认账号: admin | 默认密码: password</p>
                </div>
            </div>
        </section>
        
        <!-- 应用主页面 -->
        <section id="appPage" class="hidden p-4 md:p-6">
            <div class="container mx-auto max-w-7xl">
                <!-- 操作按钮区 -->
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-neutral-800">我的衣物</h2>
                    <div class="flex flex-wrap gap-3">
                        <button id="addClothesBtn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center space-x-2">
                            <i class="fa fa-plus"></i>
                            <span>添加衣物</span>
                        </button>
                        <button id="batchUploadBtn" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center space-x-2">
                            <i class="fa fa-upload"></i>
                            <span>批量上传</span>
                        </button>
                    </div>
                </div>
                
                <!-- 分类筛选 -->
                <div class="mb-6 overflow-x-auto pb-2">
                    <div class="flex space-x-2 min-w-max">
                        <button class="category-filter active px-4 py-2 bg-primary text-white rounded-full text-sm font-medium transition-colors" data-category="all">
                            全部
                        </button>
                        <button class="category-filter px-4 py-2 bg-white text-neutral-600 hover:bg-primary/10 rounded-full text-sm font-medium transition-colors" data-category="上衣">
                            <i class="fa fa-tshirt mr-1"></i>上衣
                        </button>
                        <button class="category-filter px-4 py-2 bg-white text-neutral-600 hover:bg-primary/10 rounded-full text-sm font-medium transition-colors" data-category="裤子">
                            <i class="fa fa-socks mr-1"></i>裤子
                        </button>
                        <button class="category-filter px-4 py-2 bg-white text-neutral-600 hover:bg-primary/10 rounded-full text-sm font-medium transition-colors" data-category="连衣裙">
                            <i class="fa fa-gown mr-1"></i>连衣裙
                        </button>
                        <button class="category-filter px-4 py-2 bg-white text-neutral-600 hover:bg-primary/10 rounded-full text-sm font-medium transition-colors" data-category="半身裙">
                            <i class="fa fa-venus mr-1"></i>半身裙
                        </button>
                        <button class="category-filter px-4 py-2 bg-white text-neutral-600 hover:bg-primary/10 rounded-full text-sm font-medium transition-colors" data-category="鞋子">
                            <i class="fa fa-shoe-prints mr-1"></i>鞋子
                        </button>
                        <button class="category-filter px-4 py-2 bg-white text-neutral-600 hover:bg-primary/10 rounded-full text-sm font-medium transition-colors" data-category="配饰">
                            <i class="fa fa-sun mr-1"></i>配饰
                        </button>
                        <button class="category-filter px-4 py-2 bg-white text-neutral-600 hover:bg-primary/10 rounded-full text-sm font-medium transition-colors" data-category="外套">
                            <i class="fa fa-user-tie mr-1"></i>外套
                        </button>
                    </div>
                </div>
                
                <!-- 衣物列表 -->
                <div id="clothesList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5">
                    <!-- 衣物卡片将通过JS动态生成 -->
                </div>
                
                <!-- 空状态 -->
                <div id="emptyState" class="hidden py-16 text-center">
                    <div class="w-24 h-24 mx-auto mb-4 text-neutral-300">
                        <i class="fa fa-tshirt text-[100px]"></i>
                    </div>
                    <h3 class="text-xl font-medium text-neutral-600 mb-2">衣橱还是空的</h3>
                    <p class="text-neutral-500 mb-6">添加你的第一件衣物开始管理吧</p>
                    <button id="emptyAddBtn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                        添加衣物
                    </button>
                </div>
            </div>
        </section>
    </main>
    
    <!-- 页脚 -->
    <footer id="footer" class="bg-white border-t border-gray-200 py-4 hidden">
        <div class="container mx-auto px-4 text-center text-neutral-500 text-sm">
            <p>© 2023 智能衣橱管理系统 | 让衣物管理更简单</p>
        </div>
    </footer>
    
    <!-- 统计分析模态框 -->
    <div id="statsModal" class="fixed inset-0 bg-black/50 modal-backdrop z-50 flex items-center justify-center p-4 hidden animate-fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-y-auto animate-slide-up">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center sticky top-0 bg-white z-10">
                <h3 class="text-xl font-bold text-neutral-800">衣物统计分析</h3>
                <button id="closeStatsBtn" class="text-neutral-500 hover:text-neutral-800 transition-colors" title="关闭统计分析">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="p-6 space-y-8">
                <!-- 基本统计信息 -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                        <p class="text-neutral-500 text-sm mb-1">衣物总数</p>
                        <p id="totalItems" class="text-2xl font-bold text-primary">0</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                        <p class="text-neutral-500 text-sm mb-1">总价值</p>
                        <p id="totalValue" class="text-2xl font-bold text-primary">¥0</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                        <p class="text-neutral-500 text-sm mb-1">平均价格</p>
                        <p id="avgPrice" class="text-2xl font-bold text-primary">¥0</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                        <p class="text-neutral-500 text-sm mb-1">本月新增</p>
                        <p id="monthlyAdditions" class="text-2xl font-bold text-primary">0</p>
                    </div>
                </div>
                
                <!-- 图表区域 -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 分类占比饼图 -->
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                        <h4 class="text-lg font-medium text-neutral-700 mb-3">衣物分类占比</h4>
                        <div class="h-64">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- 季节分布饼图 -->
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                        <h4 class="text-lg font-medium text-neutral-700 mb-3">季节分布</h4>
                        <div class="h-64">
                            <canvas id="seasonChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- 月度购买趋势 -->
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                        <h4 class="text-lg font-medium text-neutral-700 mb-3">月度购买趋势</h4>
                        <div class="h-64">
                            <canvas id="monthlyPurchaseChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- 价格分布 -->
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-100">
                        <h4 class="text-lg font-medium text-neutral-700 mb-3">价格区间分布</h4>
                        <div class="h-64">
                            <canvas id="priceRangeChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- 穿着频率最高的衣物 -->
                <div>
                    <h4 class="text-lg font-medium text-neutral-700 mb-3">穿着频率最高的衣物</h4>
                    <div id="mostWornList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                        <!-- 穿着频率高的衣物将通过JS动态生成 -->
                    </div>
                </div>
                
                <!-- 最近购买的衣物 -->
                <div>
                    <h4 class="text-lg font-medium text-neutral-700 mb-3">最近购买的衣物</h4>
                    <div id="recentPurchases" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                        <!-- 最近购买的衣物将通过JS动态生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 添加/编辑衣物模态框 -->
    <div id="clothesModal" class="fixed inset-0 bg-black/50 modal-backdrop z-50 flex items-center justify-center p-4 hidden animate-fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-slide-up">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center sticky top-0 bg-white z-10">
                <h3 id="clothesModalTitle" class="text-xl font-bold text-neutral-800">添加衣物</h3>
                <button id="closeClothesModal" class="text-neutral-500 hover:text-neutral-800 transition-colors" title="关闭衣物编辑">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="clothesForm" class="p-6 space-y-5">
                <input type="hidden" id="clothesId">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label for="name" class="block text-sm font-medium text-neutral-700 mb-1">衣物名称 <span class="text-red-500">*</span></label>
                        <input type="text" id="name" name="name" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none"
                            placeholder="例如：黑色T恤">
                    </div>
                    
                    <div>
                        <label for="category" class="block text-sm font-medium text-neutral-700 mb-1">分类 <span class="text-red-500">*</span></label>
                        <select id="category" name="category" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none appearance-none bg-white">
                            <option value="">请选择分类</option>
                            <option value="上衣">上衣</option>
                            <option value="裤子">裤子</option>
                            <option value="连衣裙">连衣裙</option>
                            <option value="半身裙">半身裙</option>
                            <option value="鞋子">鞋子</option>
                            <option value="配饰">配饰</option>
                            <option value="外套">外套</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label for="season" class="block text-sm font-medium text-neutral-700 mb-1">适用季节 <span class="text-red-500">*</span></label>
                        <select id="season" name="season" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none appearance-none bg-white">
                            <option value="">请选择季节</option>
                            <option value="春季">春季</option>
                            <option value="夏季">夏季</option>
                            <option value="秋季">秋季</option>
                            <option value="冬季">冬季</option>
                            <option value="四季">四季</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="color" class="block text-sm font-medium text-neutral-700 mb-1">颜色 <span class="text-red-500">*</span></label>
                        <input type="text" id="color" name="color" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none"
                            placeholder="例如：黑色、蓝色、花色">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label for="brand" class="block text-sm font-medium text-neutral-700 mb-1">品牌</label>
                        <input type="text" id="brand" name="brand"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none"
                            placeholder="例如：优衣库、Nike">
                    </div>
                    
                    <div>
                        <label for="purchaseDate" class="block text-sm font-medium text-neutral-700 mb-1">购买日期</label>
                        <input type="date" id="purchaseDate" name="purchaseDate"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none">
                    </div>
                </div>
                
                <div>
                    <label for="price" class="block text-sm font-medium text-neutral-700 mb-1">购买金额 (¥)</label>
                    <input type="number" id="price" name="price" min="0" step="0.01"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none"
                        placeholder="输入购买金额">
                </div>
                
                <div>
                    <label for="image" class="block text-sm font-medium text-neutral-700 mb-1">衣物图片</label>
                    <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-primary transition-colors">
                        <div class="space-y-1 text-center">
                            <i class="fa fa-cloud-upload text-neutral-400 text-3xl mb-2"></i>
                            <div class="flex text-sm text-neutral-600">
                                <label for="image" class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-primary/80 focus-within:outline-none">
                                    <span>上传图片</span>
                                    <input id="image" name="image" type="file" accept="image/*" class="sr-only">
                                </label>
                                <p class="pl-1">或拖放文件</p>
                            </div>
                            <p class="text-xs text-neutral-500">支持 PNG, JPG, GIF 格式 (最大 5MB)</p>
                        </div>
                    </div>
                    <div id="previewContainer" class="mt-3 hidden">
                        <img id="imagePreview" src="" alt="衣物预览图" class="max-h-64 object-contain rounded-lg border border-gray-200">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                    <button type="button" id="cancelClothesBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-neutral-700 hover:bg-gray-50 transition-colors">
                        取消
                    </button>
                    <button type="submit" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 批量上传模态框 -->
    <div id="batchModal" class="fixed inset-0 bg-black/50 modal-backdrop z-50 flex items-center justify-center p-4 hidden animate-fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-slide-up">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center sticky top-0 bg-white z-10">
                <h3 class="text-xl font-bold text-neutral-800">批量上传衣物</h3>
                <button id="closeBatchModal" class="text-neutral-500 hover:text-neutral-800 transition-colors" title="关闭批量上传">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="p-6 space-y-5">
                <div>
                    <h4 class="text-lg font-medium text-neutral-700 mb-3">批量输入衣物信息</h4>
                    <p class="text-sm text-neutral-500 mb-3">请按照以下格式输入，每行一条记录：</p>
                    <div class="bg-gray-50 p-3 rounded-lg text-sm font-mono text-neutral-700 mb-3">
                        衣物名称,分类,季节,颜色,品牌,购买日期,金额
                    </div>
                    <p class="text-sm text-neutral-500 mb-3">示例：</p>
                    <div class="bg-gray-50 p-3 rounded-lg text-sm font-mono text-neutral-700 mb-3">
                        白色T恤,上衣,夏季,白色,优衣库,2023-05-15,99<br>
                        牛仔裤,裤子,四季,蓝色,Levi's,2023-03-20,399<br>
                        运动鞋,鞋子,四季,黑白,Nike,2023-01-10,799
                    </div>
                    <textarea id="batchText" rows="8" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all outline-none"
                        placeholder="请输入衣物信息..."></textarea>
                </div>
                
                <div>
                    <h4 class="text-lg font-medium text-neutral-700 mb-3">批量上传图片（可选）</h4>
                    <p class="text-sm text-neutral-500 mb-3">上传的图片将按顺序与输入的衣物信息匹配</p>
                    <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-primary transition-colors">
                        <div class="space-y-1 text-center">
                            <i class="fa fa-images text-neutral-400 text-3xl mb-2"></i>
                            <div class="flex text-sm text-neutral-600">
                                <label for="batchImages" class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-primary/80 focus-within:outline-none">
                                    <span>选择图片</span>
                                    <input id="batchImages" name="batchImages" type="file" accept="image/*" multiple class="sr-only">
                                </label>
                                <p class="pl-1">可选择多张</p>
                            </div>
                            <p class="text-xs text-neutral-500">支持 PNG, JPG, GIF 格式</p>
                        </div>
                    </div>
                    <div id="batchImagesPreview" class="mt-3 flex flex-wrap gap-2">
                        <!-- 图片预览将在这里显示 -->
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                    <button type="button" id="cancelBatchBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-neutral-700 hover:bg-gray-50 transition-colors">
                        取消
                    </button>
                    <button id="submitBatchBtn" class="px-4 py-2 bg-secondary hover:bg-secondary/90 text-white rounded-lg transition-colors">
                        批量添加
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 穿着记录模态框 -->
    <div id="wearModal" class="fixed inset-0 bg-black/50 modal-backdrop z-50 flex items-center justify-center p-4 hidden animate-fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md animate-slide-up">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                <h3 class="text-xl font-bold text-neutral-800">记录穿着</h3>
                <button id="closeWearModal" class="text-neutral-500 hover:text-neutral-800 transition-colors" title="关闭穿着记录">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="p-6 space-y-5">
                <input type="hidden" id="wearClothesId">
                
                <div class="text-center">
                    <p id="wearClothesName" class="text-lg font-medium text-neutral-800 mb-1"></p>
                    <p class="text-neutral-500">当前穿着次数: <span id="currentWearCount" class="font-medium">0</span></p>
                </div>
                
                <div class="pt-4 border-t border-gray-100">
                    <p class="text-center text-neutral-700 mb-4">今天穿了这件衣物吗？</p>
                    <div class="flex justify-center space-x-4">
                        <button id="confirmWearBtn" class="px-6 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors">
                            是的
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 删除确认模态框 -->
    <div id="deleteModal" class="fixed inset-0 bg-black/50 modal-backdrop z-50 flex items-center justify-center p-4 hidden animate-fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md animate-slide-up">
            <div class="p-6 border-b border-gray-100">
                <h3 class="text-xl font-bold text-neutral-800">确认删除</h3>
            </div>
            
            <div class="p-6 space-y-5">
                <input type="hidden" id="deleteClothesId">
                
                <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-4 flex items-center justify-center text-red-500 bg-red-50 rounded-full">
                        <i class="fa fa-trash text-2xl"></i>
                    </div>
                    <p class="text-neutral-700 mb-1">你确定要删除这件衣物吗？</p>
                    <p class="text-neutral-500 text-sm">此操作无法撤销</p>
                </div>
                
                <div class="flex justify-center space-x-4 pt-4 border-t border-gray-100">
                    <button id="cancelDeleteBtn" class="px-6 py-2 border border-gray-300 rounded-lg text-neutral-700 hover:bg-gray-50 transition-colors">
                        取消
                    </button>
                    <button id="confirmDeleteBtn" class="px-6 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
                        删除
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-5 right-5 bg-white shadow-lg rounded-lg p-4 max-w-xs transform translate-y-20 opacity-0 transition-all duration-300 pointer-events-none flex items-start space-x-3 z-50">
        <div id="notificationIcon" class="text-green-500 mt-0.5">
            <i class="fa fa-check-circle text-xl"></i>
        </div>
        <div>
            <h4 id="notificationTitle" class="font-medium text-neutral-800"></h4>
            <p id="notificationMessage" class="text-sm text-neutral-600 mt-1"></p>
        </div>
        <button id="closeNotification" class="text-neutral-400 hover:text-neutral-600 ml-auto transition-colors" title="关闭通知">
            <i class="fa fa-times"></i>
        </button>
    </div>

    <script>
        // 等待整个文档加载完成
        document.addEventListener('DOMContentLoaded', function() {
            // 图片处理工具
            const ImageUtils = {
                // 压缩图片
                compressImage: async (file, maxWidth = 800, maxHeight = 800, quality = 0.8) => {
                    return new Promise((resolve, reject) => {
                        const img = new Image();
                        img.src = URL.createObjectURL(file);
                        
                        img.onload = () => {
                            let width = img.width;
                            let height = img.height;
                            
                            // 计算缩放比例
                            if (width > maxWidth || height > maxHeight) {
                                const ratio = Math.min(maxWidth / width, maxHeight / height);
                                width *= ratio;
                                height *= ratio;
                            }
                            
                            // 创建画布并绘制图片
                            const canvas = document.createElement('canvas');
                            canvas.width = width;
                            canvas.height = height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);
                            
                            // 将画布内容转为Blob
                            canvas.toBlob((blob) => {
                                if (blob) {
                                    resolve(blob);
                                } else {
                                    reject(new Error('无法压缩图片'));
                                }
                            }, file.type || 'image/jpeg', quality);
                        };
                        
                        img.onerror = () => {
                            reject(new Error('图片加载失败'));
                        };
                    });
                },
                
                // 将图片文件转为Base64
                fileToBase64: async (file) => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onloadend = () => {
                            resolve(reader.result);
                        };
                        reader.onerror = reject;
                        
                        // 如果文件过大，先压缩再转换
                        if (file.size > 5 * 1024 * 1024) { // 5MB
                            this.compressImage(file)
                                .then(blob => {
                                    reader.readAsDataURL(blob);
                                })
                                .catch(reject);
                        } else {
                            reader.readAsDataURL(file);
                        }
                    });
                }
            };

            // 应用状态管理
            const AppState = {
                clothes: [],
                currentUser: null,
                
                // 初始化数据
                init() {
                    this.loadFromLocalStorage();
                },
                
                // 从本地存储加载数据
                loadFromLocalStorage() {
                    const savedClothes = localStorage.getItem('wardrobe_clothes');
                    const savedUser = localStorage.getItem('wardrobe_user');
                    
                    if (savedClothes) {
                        this.clothes = JSON.parse(savedClothes);
                    }
                    
                    if (savedUser) {
                        this.currentUser = JSON.parse(savedUser);
                    }
                },
                
                // 保存数据到本地存储
                saveToLocalStorage() {
                    localStorage.setItem('wardrobe_clothes', JSON.stringify(this.clothes));
                },
                
                // 保存用户状态
                saveUser(user) {
                    this.currentUser = user;
                    localStorage.setItem('wardrobe_user', JSON.stringify(user));
                },
                
                // 登出
                logout() {
                    this.currentUser = null;
                    localStorage.removeItem('wardrobe_user');
                },
                
                // 添加衣物
                addClothes(item) {
                    // 生成唯一ID
                    item.id = Date.now().toString();
                    // 添加默认属性
                    item.wearCount = 0;
                    item.wearHistory = [];
                    item.addedDate = new Date().toISOString().split('T')[0];
                    
                    this.clothes.push(item);
                    this.saveToLocalStorage();
                    return item;
                },
                
                // 更新衣物
                updateClothes(updatedItem) {
                    const index = this.clothes.findIndex(item => item.id === updatedItem.id);
                    if (index !== -1) {
                        this.clothes[index] = { ...this.clothes[index], ...updatedItem };
                        this.saveToLocalStorage();
                        return this.clothes[index];
                    }
                    return null;
                },
                
                // 删除衣物
                deleteClothes(id) {
                    const initialLength = this.clothes.length;
                    this.clothes = this.clothes.filter(item => item.id !== id);
                    this.saveToLocalStorage();
                    return initialLength > this.clothes.length;
                },
                
                // 记录穿着
                recordWear(id) {
                    const item = this.clothes.find(item => item.id === id);
                    if (item) {
                        item.wearCount = (item.wearCount || 0) + 1;
                        item.wearHistory = item.wearHistory || [];
                        item.wearHistory.push(new Date().toISOString().split('T')[0]);
                        this.saveToLocalStorage();
                        return true;
                    }
                    return false;
                },
                
                // 获取分类统计
                getCategoryStats() {
                    const stats = {};
                    this.clothes.forEach(item => {
                        stats[item.category] = (stats[item.category] || 0) + 1;
                    });
                    return stats;
                },
                
                // 获取季节统计
                getSeasonStats() {
                    const stats = {};
                    this.clothes.forEach(item => {
                        stats[item.season] = (stats[item.season] || 0) + 1;
                    });
                    return stats;
                },
                
                // 获取穿着最多的衣物
                getMostWorn(limit = 3) {
                    return [...this.clothes]
                        .sort((a, b) => (b.wearCount || 0) - (a.wearCount || 0))
                        .slice(0, limit);
                },
                
                // 获取最近购买的衣物
                getRecentPurchases(limit = 3) {
                    return [...this.clothes]
                        .filter(item => item.purchaseDate)
                        .sort((a, b) => new Date(b.purchaseDate) - new Date(a.purchaseDate))
                        .slice(0, limit);
                },
                
                // 获取月度购买统计
                getMonthlyPurchaseStats() {
                    const stats = {};
                    const today = new Date();
                    
                    // 生成过去12个月
                    for (let i = 11; i >= 0; i--) {
                        const month = new Date();
                        month.setMonth(today.getMonth() - i);
                        const key = `${month.getFullYear()}-${String(month.getMonth() + 1).padStart(2, '0')}`;
                        stats[key] = 0;
                    }
                    
                    // 统计每个月的购买数量
                    this.clothes.forEach(item => {
                        if (item.purchaseDate) {
                            const date = new Date(item.purchaseDate);
                            const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                            if (stats.hasOwnProperty(key)) {
                                stats[key]++;
                            }
                        }
                    });
                    
                    return stats;
                },
                
                // 获取价格区间统计
                getPriceRangeStats() {
                    const ranges = {
                        '0-99': 0,
                        '100-299': 0,
                        '300-499': 0,
                        '500-999': 0,
                        '1000+': 0
                    };
                    
                    this.clothes.forEach(item => {
                        const price = Number(item.price) || 0;
                        
                        if (price < 100) {
                            ranges['0-99']++;
                        } else if (price < 300) {
                            ranges['100-299']++;
                        } else if (price < 500) {
                            ranges['300-499']++;
                        } else if (price < 1000) {
                            ranges['500-999']++;
                        } else {
                            ranges['1000+']++;
                        }
                    });
                    
                    return ranges;
                },
                
                // 获取本月新增数量
                getMonthlyAdditions() {
                    const today = new Date();
                    const currentMonth = today.getMonth();
                    const currentYear = today.getFullYear();
                    
                    return this.clothes.filter(item => {
                        const addedDate = new Date(item.addedDate);
                        return addedDate.getMonth() === currentMonth && addedDate.getFullYear() === currentYear;
                    }).length;
                },
                
                // 获取总价值
                getTotalValue() {
                    return this.clothes.reduce((total, item) => total + (Number(item.price) || 0), 0);
                }
            };

            // 应用UI控制器
            const UIController = {
                // 初始化UI
                init() {
                    this.cacheDOM();
                    this.bindEvents();
                    this.checkLoginStatus();
                    this.showNavbar();
                },
                
                // 缓存DOM元素
                cacheDOM() {
                    // 页面容器
                    this.loginPage = document.getElementById('loginPage');
                    this.appPage = document.getElementById('appPage');
                    this.footer = document.getElementById('footer');
                    
                    // 登录相关
                    this.loginForm = document.getElementById('loginForm');
                    this.usernameInput = document.getElementById('username');
                    this.passwordInput = document.getElementById('password');
                    this.togglePasswordBtn = document.getElementById('togglePassword');
                    this.logoutBtn = document.getElementById('logoutBtn');
                    this.mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
                    
                    // 导航栏
                    this.navbar = document.getElementById('navbar');
                    this.mobileMenuBtn = document.getElementById('mobileMenuBtn');
                    this.mobileMenu = document.getElementById('mobileMenu');
                    
                    // 衣物列表
                    this.clothesList = document.getElementById('clothesList');
                    this.emptyState = document.getElementById('emptyState');
                    this.emptyAddBtn = document.getElementById('emptyAddBtn');
                    
                    // 分类筛选
                    this.categoryFilters = document.querySelectorAll('.category-filter');
                    
                    // 按钮
                    this.addClothesBtn = document.getElementById('addClothesBtn');
                    this.batchUploadBtn = document.getElementById('batchUploadBtn');
                    
                    // 统计相关
                    this.statsBtn = document.getElementById('statsBtn');
                    this.mobileStatsBtn = document.getElementById('mobileStatsBtn');
                    this.statsModal = document.getElementById('statsModal');
                    this.closeStatsBtn = document.getElementById('closeStatsBtn');
                    this.totalItemsEl = document.getElementById('totalItems');
                    this.totalValueEl = document.getElementById('totalValue');
                    this.avgPriceEl = document.getElementById('avgPrice');
                    this.monthlyAdditionsEl = document.getElementById('monthlyAdditions');
                    this.mostWornList = document.getElementById('mostWornList');
                    this.recentPurchases = document.getElementById('recentPurchases');
                    
                    // 图表
                    this.categoryChart = document.getElementById('categoryChart');
                    this.seasonChart = document.getElementById('seasonChart');
                    this.monthlyPurchaseChart = document.getElementById('monthlyPurchaseChart');
                    this.priceRangeChart = document.getElementById('priceRangeChart');
                    
                    // 衣物表单模态框
                    this.clothesModal = document.getElementById('clothesModal');
                    this.clothesModalTitle = document.getElementById('clothesModalTitle');
                    this.closeClothesModal = document.getElementById('closeClothesModal');
                    this.cancelClothesBtn = document.getElementById('cancelClothesBtn');
                    this.clothesForm = document.getElementById('clothesForm');
                    this.clothesIdInput = document.getElementById('clothesId');
                    this.nameInput = document.getElementById('name');
                    this.categoryInput = document.getElementById('category');
                    this.seasonInput = document.getElementById('season');
                    this.colorInput = document.getElementById('color');
                    this.brandInput = document.getElementById('brand');
                    this.purchaseDateInput = document.getElementById('purchaseDate');
                    this.priceInput = document.getElementById('price');
                    this.imageInput = document.getElementById('image');
                    this.previewContainer = document.getElementById('previewContainer');
                    this.imagePreview = document.getElementById('imagePreview');
                    
                    // 批量上传模态框
                    this.batchModal = document.getElementById('batchModal');
                    this.closeBatchModal = document.getElementById('closeBatchModal');
                    this.cancelBatchBtn = document.getElementById('cancelBatchBtn');
                    this.submitBatchBtn = document.getElementById('submitBatchBtn');
                    this.batchText = document.getElementById('batchText');
                    this.batchImages = document.getElementById('batchImages');
                    this.batchImagesPreview = document.getElementById('batchImagesPreview');
                    
                    // 穿着记录模态框
                    this.wearModal = document.getElementById('wearModal');
                    this.closeWearModal = document.getElementById('closeWearModal');
                    this.wearClothesIdInput = document.getElementById('wearClothesId');
                    this.wearClothesNameEl = document.getElementById('wearClothesName');
                    this.currentWearCountEl = document.getElementById('currentWearCount');
                    this.confirmWearBtn = document.getElementById('confirmWearBtn');
                    
                    // 删除确认模态框
                    this.deleteModal = document.getElementById('deleteModal');
                    this.closeDeleteModal = document.getElementById('closeDeleteBtn'); // 注意: 原HTML中此ID可能拼写有误
                    this.cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
                    this.confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
                    this.deleteClothesIdInput = document.getElementById('deleteClothesId');
                    
                    // 通知
                    this.notification = document.getElementById('notification');
                    this.notificationTitle = document.getElementById('notificationTitle');
                    this.notificationMessage = document.getElementById('notificationMessage');
                    this.notificationIcon = document.getElementById('notificationIcon');
                    this.closeNotification = document.getElementById('closeNotification');
                },
                
                // 绑定事件处理程序
                bindEvents() {
                    // 确保元素存在再绑定事件
                    if (this.loginForm) {
                        this.loginForm.addEventListener('submit', (e) => this.handleLogin(e));
                    }
                    
                    if (this.togglePasswordBtn) {
                        this.togglePasswordBtn.addEventListener('click', () => this.togglePassword());
                    }
                    
                    if (this.logoutBtn) {
                        this.logoutBtn.addEventListener('click', () => this.handleLogout());
                    }
                    
                    if (this.mobileLogoutBtn) {
                        this.mobileLogoutBtn.addEventListener('click', () => {
                            this.toggleMobileMenu();
                            this.handleLogout();
                        });
                    }
                    
                    if (this.mobileMenuBtn) {
                        this.mobileMenuBtn.addEventListener('click', () => this.toggleMobileMenu());
                    }
                    
                    if (this.addClothesBtn) {
                        this.addClothesBtn.addEventListener('click', () => this.openClothesModal());
                    }
                    
                    if (this.emptyAddBtn) {
                        this.emptyAddBtn.addEventListener('click', () => this.openClothesModal());
                    }
                    
                    if (this.batchUploadBtn) {
                        this.batchUploadBtn.addEventListener('click', () => this.openBatchModal());
                    }
                    
                    if (this.statsBtn) {
                        this.statsBtn.addEventListener('click', () => this.openStatsModal());
                    }
                    
                    if (this.mobileStatsBtn) {
                        this.mobileStatsBtn.addEventListener('click', () => {
                            this.toggleMobileMenu();
                            this.openStatsModal();
                        });
                    }
                    
                    if (this.closeStatsBtn) {
                        this.closeStatsBtn.addEventListener('click', () => this.closeStatsModal());
                    }
                    
                    // 分类筛选按钮
                    this.categoryFilters.forEach(btn => {
                        btn.addEventListener('click', () => this.filterByCategory(btn.dataset.category));
                    });
                    
                    // 衣物表单
                    if (this.clothesForm) {
                        this.clothesForm.addEventListener('submit', (e) => this.handleClothesFormSubmit(e));
                    }
                    
                    if (this.closeClothesModal) {
                        this.closeClothesModal.addEventListener('click', () => this.closeClothesModalFunc());
                    }
                    
                    if (this.cancelClothesBtn) {
                        this.cancelClothesBtn.addEventListener('click', () => this.closeClothesModalFunc());
                    }
                    
                    if (this.imageInput) {
                        this.imageInput.addEventListener('change', (e) => this.handleImageChange(e));
                    }
                    
                    // 批量上传
                    if (this.closeBatchModal) {
                        this.closeBatchModal.addEventListener('click', () => this.closeBatchModalFunc());
                    }
                    
                    if (this.cancelBatchBtn) {
                        this.cancelBatchBtn.addEventListener('click', () => this.closeBatchModalFunc());
                    }
                    
                    if (this.submitBatchBtn) {
                        this.submitBatchBtn.addEventListener('click', () => this.handleBatchSubmit());
                    }
                    
                    if (this.batchImages) {
                        this.batchImages.addEventListener('change', (e) => this.handleBatchImagesChange(e));
                    }
                    
                    // 穿着记录
                    if (this.closeWearModal) {
                        this.closeWearModal.addEventListener('click', () => this.closeWearModalFunc());
                    }
                    
                    if (this.confirmWearBtn) {
                        this.confirmWearBtn.addEventListener('click', () => this.handleConfirmWear());
                    }
                    
                    // 删除确认
                    // 注意: 原HTML中关闭删除模态框的按钮ID可能是"closeDeleteBtn"而不是"closeWearModal"
                    if (document.getElementById('closeDeleteBtn')) {
                        document.getElementById('closeDeleteBtn').addEventListener('click', () => this.closeDeleteModalFunc());
                    }
                    
                    if (this.cancelDeleteBtn) {
                        this.cancelDeleteBtn.addEventListener('click', () => this.closeDeleteModalFunc());
                    }
                    
                    if (this.confirmDeleteBtn) {
                        this.confirmDeleteBtn.addEventListener('click', () => this.handleConfirmDelete());
                    }
                    
                    // 通知
                    if (this.closeNotification) {
                        this.closeNotification.addEventListener('click', () => this.hideNotification());
                    }
                    
                    // 为动态生成的元素使用事件委托
                    if (this.clothesList) {
                        this.clothesList.addEventListener('click', (e) => this.handleClothesListClick(e));
                    }
                },
                
                // 检查登录状态
                checkLoginStatus() {
                    if (AppState.currentUser) {
                        this.showApp();
                    } else {
                        this.showLogin();
                    }
                },
                
                // 显示登录页面
                showLogin() {
                    if (this.loginPage) this.loginPage.classList.remove('hidden');
                    if (this.appPage) this.appPage.classList.add('hidden');
                    if (this.footer) this.footer.classList.add('hidden');
                },
                
                // 显示应用页面
                showApp() {
                    if (this.loginPage) this.loginPage.classList.add('hidden');
                    if (this.appPage) this.appPage.classList.remove('hidden');
                    if (this.footer) this.footer.classList.remove('hidden');
                    
                    this.renderClothesList();
                },
                
                // 显示导航栏
                showNavbar() {
                    setTimeout(() => {
                        if (this.navbar) {
                            this.navbar.classList.remove('-translate-y-full');
                        }
                    }, 300);
                },
                
                // 切换移动端菜单
                toggleMobileMenu() {
                    if (this.mobileMenu) {
                        this.mobileMenu.classList.toggle('hidden');
                    }
                },
                
                // 处理登录
                handleLogin(e) {
                    e.preventDefault();
                    
                    const username = this.usernameInput.value.trim();
                    const password = this.passwordInput.value.trim();
                    
                    // 简单验证 - 实际应用中应该有更安全的验证
                    if ((username === 'mackey' && password === 'xu920926')) {
                        AppState.saveUser({ username });
                        this.showNotification('登录成功', '欢迎回来，' + username);
                        this.checkLoginStatus();
                    } else {
                        this.showNotification('登录失败', '用户名或密码错误', 'error');
                    }
                },
                
                // 处理登出
                handleLogout() {
                    AppState.logout();
                    this.showNotification('已登出', '您已成功退出登录');
                    this.checkLoginStatus();
                },
                
                // 切换密码显示
                togglePassword() {
                    const type = this.passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    this.passwordInput.setAttribute('type', type);
                    
                    // 切换图标
                    const icon = this.togglePasswordBtn.querySelector('i');
                    if (icon) {
                        if (type === 'password') {
                            icon.classList.remove('fa-eye');
                            icon.classList.add('fa-eye-slash');
                        } else {
                            icon.classList.remove('fa-eye-slash');
                            icon.classList.add('fa-eye');
                        }
                    }
                },
                
                // 渲染衣物列表
                renderClothesList(filter = 'all') {
                    if (!this.clothesList) return;
                    
                    this.clothesList.innerHTML = '';
                    
                    let filteredClothes = AppState.clothes;
                    if (filter !== 'all') {
                        filteredClothes = AppState.clothes.filter(item => item.category === filter);
                    }
                    
                    // 显示空状态或列表
                    if (filteredClothes.length === 0) {
                        if (this.emptyState) this.emptyState.classList.remove('hidden');
                        return;
                    } else {
                        if (this.emptyState) this.emptyState.classList.add('hidden');
                    }
                    
                    // 渲染衣物卡片
                    filteredClothes.forEach(item => {
                        const card = document.createElement('div');
                        card.className = 'bg-white rounded-xl overflow-hidden card-shadow hover-lift';
                        card.dataset.id = item.id;
                        
                        // 处理图片
                        const imageSrc = item.image || 'https://picsum.photos/300/300?random=' + item.id;
                        
                        card.innerHTML = `
                            <div class="relative h-48 bg-gray-100">
                                <img src="${imageSrc}" alt="${item.name}" class="w-full h-full object-cover">
                                <div class="absolute top-2 right-2 flex space-x-1">
                                    <button class="edit-btn p-1.5 bg-white/80 backdrop-blur-sm rounded-full text-neutral-700 hover:text-primary transition-colors" title="编辑">
                                        <i class="fa fa-edit"></i>
                                    </button>
                                    <button class="delete-btn p-1.5 bg-white/80 backdrop-blur-sm rounded-full text-neutral-700 hover:text-red-500 transition-colors" title="删除">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                                <div class="absolute bottom-2 left-2 bg-primary/90 text-white text-xs px-2 py-1 rounded-full backdrop-blur-sm">
                                    ${item.category}
                                </div>
                                <div class="absolute top-2 left-2 bg-white/80 backdrop-blur-sm text-neutral-700 text-xs px-2 py-1 rounded-full">
                                    <i class="fa fa-sun-o mr-1"></i>${item.season}
                                </div>
                            </div>
                            <div class="p-4">
                                <h3 class="font-medium text-neutral-800 mb-1 truncate">${item.name}</h3>
                                <p class="text-sm text-neutral-500 mb-3">${item.color} | ${item.brand || '无品牌'}</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-primary font-medium">¥${item.price || '0'}</span>
                                    <button class="wear-btn text-sm bg-gray-100 hover:bg-gray-200 text-neutral-700 px-3 py-1 rounded-full transition-colors flex items-center">
                                        <i class="fa fa-check mr-1"></i> 已穿 ${item.wearCount || 0} 次
                                    </button>
                                </div>
                            </div>
                        `;
                        
                        this.clothesList.appendChild(card);
                    });
                },
                
                // 按分类筛选
                filterByCategory(category) {
                    // 更新筛选按钮样式
                    this.categoryFilters.forEach(btn => {
                        if (btn.dataset.category === category) {
                            btn.classList.add('bg-primary', 'text-white');
                            btn.classList.remove('bg-white', 'text-neutral-600', 'hover:bg-primary/10');
                        } else {
                            btn.classList.remove('bg-primary', 'text-white');
                            btn.classList.add('bg-white', 'text-neutral-600', 'hover:bg-primary/10');
                        }
                    });
                    
                    this.renderClothesList(category);
                },
                
                // 打开衣物模态框
                openClothesModal(item = null) {
                    // 重置表单
                    this.clothesForm.reset();
                    this.clothesIdInput.value = '';
                    this.previewContainer.classList.add('hidden');
                    this.imagePreview.src = '';
                    
                    // 设置标题
                    if (item) {
                        this.clothesModalTitle.textContent = '编辑衣物';
                        this.clothesIdInput.value = item.id;
                        this.nameInput.value = item.name;
                        this.categoryInput.value = item.category;
                        this.seasonInput.value = item.season;
                        this.colorInput.value = item.color;
                        this.brandInput.value = item.brand || '';
                        this.purchaseDateInput.value = item.purchaseDate || '';
                        this.priceInput.value = item.price || '';
                        
                        // 显示现有图片
                        if (item.image) {
                            this.imagePreview.src = item.image;
                            this.previewContainer.classList.remove('hidden');
                        }
                    } else {
                        this.clothesModalTitle.textContent = '添加衣物';
                    }
                    
                    // 显示模态框
                    if (this.clothesModal) {
                        this.clothesModal.classList.remove('hidden');
                        // 阻止背景滚动
                        document.body.style.overflow = 'hidden';
                    }
                },
                
                // 关闭衣物模态框
                closeClothesModalFunc() {
                    if (this.clothesModal) {
                        this.clothesModal.classList.add('hidden');
                        // 恢复背景滚动
                        document.body.style.overflow = '';
                    }
                },
                
                // 处理图片选择
                handleImageChange(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // 预览图片
                        ImageUtils.fileToBase64(file)
                            .then(base64 => {
                                this.imagePreview.src = base64;
                                this.previewContainer.classList.remove('hidden');
                            })
                            .catch(error => {
                                this.showNotification('图片处理失败', error.message, 'error');
                            });
                    }
                },
                
                // 处理衣物表单提交
                handleClothesFormSubmit(e) {
                    e.preventDefault();
                    
                    // 获取表单数据
                    const clothesId = this.clothesIdInput.value;
                    const clothesData = {
                        name: this.nameInput.value.trim(),
                        category: this.categoryInput.value,
                        season: this.seasonInput.value,
                        color: this.colorInput.value.trim(),
                        brand: this.brandInput.value.trim(),
                        purchaseDate: this.purchaseDateInput.value,
                        price: this.priceInput.value
                    };
                    
                    // 如果有新图片，添加图片数据
                    if (this.imageInput.files.length > 0) {
                        ImageUtils.fileToBase64(this.imageInput.files[0])
                            .then(base64 => {
                                clothesData.image = base64;
                                this.saveClothesData(clothesId, clothesData);
                            })
                            .catch(error => {
                                this.showNotification('图片处理失败', error.message, 'error');
                            });
                    } else {
                        // 如果是编辑且没有选择新图片，不更新图片
                        if (!clothesId) {
                            // 添加新衣物但没有图片，使用默认图片
                            clothesData.image = `https://picsum.photos/300/300?random=${Date.now()}`;
                        }
                        this.saveClothesData(clothesId, clothesData);
                    }
                },
                
                // 保存衣物数据
                saveClothesData(id, data) {
                    let result;
                    
                    if (id) {
                        // 更新现有衣物
                        result = AppState.updateClothes({ ...data, id });
                        if (result) {
                            this.showNotification('更新成功', '衣物信息已更新');
                        }
                    } else {
                        // 添加新衣物
                        result = AppState.addClothes(data);
                        if (result) {
                            this.showNotification('添加成功', '新衣物已添加到衣橱');
                        }
                    }
                    
                    if (result) {
                        this.closeClothesModalFunc();
                        this.renderClothesList();
                    } else {
                        this.showNotification('操作失败', '无法保存衣物信息', 'error');
                    }
                },
                
                // 打开批量上传模态框
                openBatchModal() {
                    // 重置表单
                    this.batchText.value = '';
                    this.batchImages.value = '';
                    this.batchImagesPreview.innerHTML = '';
                    
                    // 显示模态框
                    if (this.batchModal) {
                        this.batchModal.classList.remove('hidden');
                        // 阻止背景滚动
                        document.body.style.overflow = 'hidden';
                    }
                },
                
                // 关闭批量上传模态框
                closeBatchModalFunc() {
                    if (this.batchModal) {
                        this.batchModal.classList.add('hidden');
                        // 恢复背景滚动
                        document.body.style.overflow = '';
                    }
                },
                
                // 处理批量上传图片
                handleBatchImagesChange(e) {
                    this.batchImagesPreview.innerHTML = '';
                    
                    const files = e.target.files;
                    if (files.length > 0) {
                        Array.from(files).forEach((file, index) => {
                            // 预览图片
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                const preview = document.createElement('div');
                                preview.className = 'relative w-20 h-20 bg-gray-100 rounded-md overflow-hidden';
                                preview.innerHTML = `
                                    <img src="${event.target.result}" alt="预览图 ${index + 1}" class="w-full h-full object-cover">
                                    <span class="absolute top-1 right-1 bg-black/60 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full">
                                        ${index + 1}
                                    </span>
                                `;
                                this.batchImagesPreview.appendChild(preview);
                            };
                            reader.readAsDataURL(file);
                        });
                    }
                },
                
                // 处理批量提交
                handleBatchSubmit() {
                    const text = this.batchText.value.trim();
                    if (!text) {
                        this.showNotification('输入为空', '请输入衣物信息', 'error');
                        return;
                    }
                    
                    const lines = text.split('\n').filter(line => line.trim() !== '');
                    if (lines.length === 0) {
                        this.showNotification('输入为空', '请输入衣物信息', 'error');
                        return;
                    }
                    
                    // 处理图片
                    const imageFiles = this.batchImages.files;
                    const imagePromises = Array.from(imageFiles).map(file => 
                        ImageUtils.fileToBase64(file)
                    );
                    
                    // 处理所有图片后再添加衣物
                    Promise.all(imagePromises)
                        .then(images => {
                            let successCount = 0;
                            
                            lines.forEach((line, index) => {
                                const parts = line.split(',').map(part => part.trim());
                                
                                // 验证格式
                                if (parts.length < 4) {
                                    console.error('格式错误:', line);
                                    return;
                                }
                                
                                // 创建衣物数据
                                const clothesData = {
                                    name: parts[0],
                                    category: parts[1],
                                    season: parts[2],
                                    color: parts[3],
                                    brand: parts[4] || '',
                                    purchaseDate: parts[5] || '',
                                    price: parts[6] || '',
                                    // 如果有对应图片则使用，否则使用默认图片
                                    image: images[index] || `https://picsum.photos/300/300?random=${Date.now() + index}`
                                };
                                
                                // 添加衣物
                                AppState.addClothes(clothesData);
                                successCount++;
                            });
                            
                            this.closeBatchModalFunc();
                            this.renderClothesList();
                            this.showNotification('批量添加完成', `成功添加 ${successCount} 件衣物`);
                        })
                        .catch(error => {
                            this.showNotification('图片处理失败', error.message, 'error');
                        });
                },
                
                // 打开穿着记录模态框
                openWearModal(id) {
                    const item = AppState.clothes.find(item => item.id === id);
                    if (!item) return;
                    
                    this.wearClothesIdInput.value = id;
                    this.wearClothesNameEl.textContent = item.name;
                    this.currentWearCountEl.textContent = item.wearCount || 0;
                    
                    if (this.wearModal) {
                        this.wearModal.classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                    }
                },
                
                // 关闭穿着记录模态框
                closeWearModalFunc() {
                    if (this.wearModal) {
                        this.wearModal.classList.add('hidden');
                        document.body.style.overflow = '';
                    }
                },
                
                // 确认穿着记录
                handleConfirmWear() {
                    const id = this.wearClothesIdInput.value;
                    if (id && AppState.recordWear(id)) {
                        this.showNotification('记录成功', '已更新穿着次数');
                        this.closeWearModalFunc();
                        this.renderClothesList();
                    } else {
                        this.showNotification('记录失败', '无法更新穿着次数', 'error');
                    }
                },
                
                // 打开删除确认模态框
                openDeleteModal(id) {
                    this.deleteClothesIdInput.value = id;
                    
                    if (this.deleteModal) {
                        this.deleteModal.classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                    }
                },
                
                // 关闭删除确认模态框
                closeDeleteModalFunc() {
                    if (this.deleteModal) {
                        this.deleteModal.classList.add('hidden');
                        document.body.style.overflow = '';
                    }
                },
                
                // 确认删除
                handleConfirmDelete() {
                    const id = this.deleteClothesIdInput.value;
                    if (id && AppState.deleteClothes(id)) {
                        this.showNotification('删除成功', '衣物已从衣橱中移除');
                        this.closeDeleteModalFunc();
                        this.renderClothesList();
                    } else {
                        this.showNotification('删除失败', '无法删除该衣物', 'error');
                    }
                },
                
                // 打开统计模态框
                openStatsModal() {
                    this.updateStatsData();
                    this.renderCharts();
                    
                    if (this.statsModal) {
                        this.statsModal.classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                    }
                },
                
                // 关闭统计模态框
                closeStatsModal() {
                    if (this.statsModal) {
                        this.statsModal.classList.add('hidden');
                        document.body.style.overflow = '';
                    }
                },
                
                // 更新统计数据
                updateStatsData() {
                    const totalItems = AppState.clothes.length;
                    const totalValue = AppState.getTotalValue();
                    const avgPrice = totalItems > 0 ? (totalValue / totalItems).toFixed(2) : '0';
                    const monthlyAdditions = AppState.getMonthlyAdditions();
                    
                    if (this.totalItemsEl) this.totalItemsEl.textContent = totalItems;
                    if (this.totalValueEl) this.totalValueEl.textContent = `¥${totalValue.toFixed(2)}`;
                    if (this.avgPriceEl) this.avgPriceEl.textContent = `¥${avgPrice}`;
                    if (this.monthlyAdditionsEl) this.monthlyAdditionsEl.textContent = monthlyAdditions;
                    
                    // 更新穿着最多的衣物
                    this.updateMostWornList();
                    
                    // 更新最近购买的衣物
                    this.updateRecentPurchases();
                },
                
                // 更新穿着最多的衣物列表
                updateMostWornList() {
                    if (!this.mostWornList) return;
                    
                    this.mostWornList.innerHTML = '';
                    const mostWorn = AppState.getMostWorn(3);
                    
                    if (mostWorn.length === 0) {
                        this.mostWornList.innerHTML = `
                            <div class="col-span-full text-center py-8 text-neutral-500">
                                <i class="fa fa-info-circle mr-1"></i> 暂无穿着记录
                            </div>
                        `;
                        return;
                    }
                    
                    mostWorn.forEach(item => {
                        const card = document.createElement('div');
                        const imageSrc = item.image || 'https://picsum.photos/300/300?random=' + item.id;
                        
                        card.className = 'bg-white rounded-lg overflow-hidden card-shadow';
                        card.innerHTML = `
                            <div class="flex">
                                <div class="w-24 h-24 bg-gray-100">
                                    <img src="${imageSrc}" alt="${item.name}" class="w-full h-full object-cover">
                                </div>
                                <div class="flex-1 p-3">
                                    <h5 class="font-medium text-neutral-800 text-sm truncate">${item.name}</h5>
                                    <p class="text-xs text-neutral-500 mt-1">${item.category} | ${item.color}</p>
                                    <div class="mt-2 flex items-center">
                                        <span class="text-primary text-sm font-medium">穿着 ${item.wearCount} 次</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        this.mostWornList.appendChild(card);
                    });
                },
                
                // 更新最近购买的衣物列表
                updateRecentPurchases() {
                    if (!this.recentPurchases) return;
                    
                    this.recentPurchases.innerHTML = '';
                    const recent = AppState.getRecentPurchases(3);
                    
                    if (recent.length === 0) {
                        this.recentPurchases.innerHTML = `
                            <div class="col-span-full text-center py-8 text-neutral-500">
                                <i class="fa fa-info-circle mr-1"></i> 暂无购买记录
                            </div>
                        `;
                        return;
                    }
                    
                    recent.forEach(item => {
                        const card = document.createElement('div');
                        const imageSrc = item.image || 'https://picsum.photos/300/300?random=' + item.id;
                        
                        card.className = 'bg-white rounded-lg overflow-hidden card-shadow';
                        card.innerHTML = `
                            <div class="flex">
                                <div class="w-24 h-24 bg-gray-100">
                                    <img src="${imageSrc}" alt="${item.name}" class="w-full h-full object-cover">
                                </div>
                                <div class="flex-1 p-3">
                                    <h5 class="font-medium text-neutral-800 text-sm truncate">${item.name}</h5>
                                    <p class="text-xs text-neutral-500 mt-1">${item.category} | ${item.purchaseDate}</p>
                                    <div class="mt-2 flex items-center">
                                        <span class="text-primary text-sm font-medium">¥${item.price || '0'}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        this.recentPurchases.appendChild(card);
                    });
                },
                
                // 渲染图表
                renderCharts() {
                    // 分类占比饼图
                    if (this.categoryChart) {
                        const categoryData = AppState.getCategoryStats();
                        this.renderPieChart(this.categoryChart, categoryData, '衣物分类占比');
                    }
                    
                    // 季节分布饼图
                    if (this.seasonChart) {
                        const seasonData = AppState.getSeasonStats();
                        this.renderPieChart(this.seasonChart, seasonData, '季节分布');
                    }
                    
                    // 月度购买趋势
                    if (this.monthlyPurchaseChart) {
                        const monthlyData = AppState.getMonthlyPurchaseStats();
                        this.renderBarChart(
                            this.monthlyPurchaseChart,
                            Object.keys(monthlyData),
                            Object.values(monthlyData),
                            '月度购买趋势',
                            '月份',
                            '购买数量'
                        );
                    }
                    
                    // 价格区间分布
                    if (this.priceRangeChart) {
                        const priceData = AppState.getPriceRangeStats();
                        this.renderBarChart(
                            this.priceRangeChart,
                            Object.keys(priceData),
                            Object.values(priceData),
                            '价格区间分布',
                            '价格区间 (¥)',
                            '衣物数量'
                        );
                    }
                },
                
                // 渲染饼图
                renderPieChart(canvas, data, label) {
                    // 销毁现有图表
                    if (canvas.chart) {
                        canvas.chart.destroy();
                    }
                    
                    const ctx = canvas.getContext('2d');
                    
                    // 生成颜色
                    const colors = Object.keys(data).map((_, index) => {
                        const hue = (index * 137) % 360; // 使用黄金角分布颜色
                        return `hsl(${hue}, 70%, 60%)`;
                    });
                    
                    // 创建图表
                    canvas.chart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                label: label,
                                data: Object.values(data),
                                backgroundColor: colors,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                }
                            }
                        }
                    });
                },
                
                // 渲染柱状图
                renderBarChart(canvas, labels, data, label, xLabel, yLabel) {
                    // 销毁现有图表
                    if (canvas.chart) {
                        canvas.chart.destroy();
                    }
                    
                    const ctx = canvas.getContext('2d');
                    
                    // 创建图表
                    canvas.chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: label,
                                data: data,
                                backgroundColor: 'rgba(99, 102, 241, 0.7)',
                                borderColor: 'rgba(99, 102, 241, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: xLabel
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: yLabel
                                    },
                                    beginAtZero: true,
                                    ticks: {
                                        precision: 0
                                    }
                                }
                            }
                        }
                    });
                },
                
                // 处理衣物列表点击事件（事件委托）
                handleClothesListClick(e) {
                    const card = e.target.closest('[data-id]');
                    if (!card) return;
                    
                    const id = card.dataset.id;
                    
                    // 编辑按钮
                    if (e.target.closest('.edit-btn')) {
                        const item = AppState.clothes.find(item => item.id === id);
                        if (item) {
                            this.openClothesModal(item);
                        }
                    }
                    // 删除按钮
                    else if (e.target.closest('.delete-btn')) {
                        this.openDeleteModal(id);
                    }
                    // 穿着记录按钮
                    else if (e.target.closest('.wear-btn')) {
                        this.openWearModal(id);
                    }
                },
                
                // 显示通知
                showNotification(title, message, type = 'success') {
                    if (!this.notification) return;
                    
                    this.notificationTitle.textContent = title;
                    this.notificationMessage.textContent = message;
                    
                    // 设置图标和颜色
                    if (type === 'error') {
                        this.notificationIcon.className = 'text-red-500 mt-0.5';
                        this.notificationIcon.innerHTML = '<i class="fa fa-exclamation-circle text-xl"></i>';
                    } else {
                        this.notificationIcon.className = 'text-green-500 mt-0.5';
                        this.notificationIcon.innerHTML = '<i class="fa fa-check-circle text-xl"></i>';
                    }
                    
                    // 显示通知
                    this.notification.classList.remove('translate-y-20', 'opacity-0');
                    this.notification.classList.add('translate-y-0', 'opacity-100');
                    this.notification.style.pointerEvents = 'auto';
                    
                    // 3秒后自动隐藏
                    setTimeout(() => {
                        this.hideNotification();
                    }, 3000);
                },
                
                // 隐藏通知
                hideNotification() {
                    if (!this.notification) return;
                    
                    this.notification.classList.remove('translate-y-0', 'opacity-100');
                    this.notification.classList.add('translate-y-20', 'opacity-0');
                    this.notification.style.pointerEvents = 'none';
                }
            };

            // 初始化应用
            function init() {
                AppState.init();
                UIController.init();
            }

            // 启动应用
            init();
        });
    </script>
</body>
</html>
